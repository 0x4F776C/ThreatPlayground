# Malware Analysis Report: Simple Keylogger

## Executive Summary
This report details the analysis of a C-based keylogger malware sample that captures keystrokes, records the active window information, and sends the collected data to a remote command and control (C2) server. The malware employs several evasion techniques and establishes persistence on the compromised system.

## Sample Information
- **File Name**: svchost.exe (not the legitimate Windows system process)
- **File Size**: 42,496 bytes
- **MD5 Hash**: 9ef2c4b5d983b47e18facbf11da48755 (example hash)
- **SHA-256 Hash**: 7ae3f5c9d8b2471fa19fe92b2c1d513e4a6d38c0c7812e9a59a93c611e283f78 (example hash)
- **Compilation Timestamp**: 2023-03-15 14:22:37 UTC

## Static Analysis

### File Properties
The malware binary appears to be a standard Windows executable compiled in C. It includes import references to several Windows API functions related to keyboard monitoring, file operations, and internet connectivity.

### Imported Libraries
- **kernel32.dll**: Basic Windows functionality
- **user32.dll**: User interface interactions, keyboard hooks
- **wininet.dll**: Internet communication capabilities
- **advapi32.dll**: Registry operations for persistence

### Key Imported Functions
- **SetWindowsHookEx**: Used to establish keyboard hooks
- **GetForegroundWindow**, **GetWindowText**: Used to identify active application
- **InternetOpenUrl**, **HttpSendRequest**: Used for C2 communication
- **RegOpenKeyEx**, **RegSetValueEx**: Used for registry-based persistence

## Dynamic Analysis

### Installation Process
When executed, the malware:
1. Checks for a mutex named "SimpleKeyloggerMutex" to prevent multiple instances
2. Copies itself to %APPDATA%\svchost.exe if not already there
3. Creates an autorun registry key at HKCU\Software\Microsoft\Windows\CurrentVersion\Run\System Service
4. Sets up a low-level keyboard hook using SetWindowsHookEx

### Data Collection
The keylogger collects:
- All keystrokes typed by the user
- Active window titles during keystroke capture
- Timestamps for each captured keystroke

### Data Storage
Captured data is written to a local file named "logs.dat" in the following format:
```
[YYYY-MM-DD HH:MM:SS] Window: [Window Title] | Key: [Key pressed]
```

### Data Exfiltration
The malware attempts to send captured data to a C2 server:
- Data is sent to http://malicious-server.example.com/upload.php
- Data is encrypted using a simple XOR operation with the key 0x5A
- Exfiltration occurs at regular intervals (every 3600 seconds)

### Anti-Analysis Techniques
The malware checks for the presence of common analysis tools:
- Process Monitor, Process Explorer, Wireshark
- OllyDbg, IDA Pro, Process Hacker
- If detected, the malware will terminate to avoid analysis

## Behavioral Analysis

### File System Activities
- Creates %APPDATA%\svchost.exe
- Creates logs.dat file in its current directory

### Registry Changes
- Adds HKCU\Software\Microsoft\Windows\CurrentVersion\Run\System Service

### Network Communications
- Periodic HTTP POST requests to the C2 server
- No observable DNS resolution attempts for the C2 domain
- XOR-encrypted data in the HTTP POST body

## Detection & Mitigation

### YARA Rule
```
rule Simple_Keylogger_Detection {
    meta:
        description = "Detects the Simple Keylogger malware"
        author = "ThreatPlayground Analyst"
        date = "2023-04-01"
        hash = "7ae3f5c9d8b2471fa19fe92b2c1d513e4a6d38c0c7812e9a59a93c611e283f78"
    
    strings:
        $mutex = "SimpleKeyloggerMutex" ascii
        $hook = "SetWindowsHookEx" ascii
        $log_format = "[%s] Window: %s | Key: %s" ascii
        $xor_key = { 5A }
        
    condition:
        uint16(0) == 0x5A4D and
        all of them
}
```

### Indicators of Compromise (IOCs)
- File: %APPDATA%\svchost.exe
- Registry: HKCU\Software\Microsoft\Windows\CurrentVersion\Run\System Service
- Network: HTTP POST requests to malicious-server.example.com
- Process: Non-system process using SetWindowsHookEx API call

### Mitigation Steps
1. Scan system with updated anti-malware software
2. Remove malicious registry entry and executable
3. Change all passwords and credentials that may have been compromised
4. Monitor for unusual network traffic to detect potential data exfiltration
5. Implement application whitelisting to prevent execution of unauthorized binaries